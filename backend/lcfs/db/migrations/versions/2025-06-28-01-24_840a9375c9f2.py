"""Add penalty override fields for director penalty amendments

Revision ID: 840a9375c9f2
Revises: 2e2f6f7ff391
Create Date: 2025-06-28 01:24:00.000000

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "840a9375c9f2"
down_revision = "2e2f6f7ff391"
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "compliance_report_summary",
        sa.Column(
            "penalty_override_enabled",
            sa.Boolean(),
            nullable=False,
            server_default=sa.text("FALSE"),
            comment="Whether penalty override is enabled (checkbox state)",
        ),
    )
    op.add_column(
        "compliance_report_summary",
        sa.Column(
            "renewable_penalty_override",
            sa.Float(),
            nullable=True,
            comment="Director override value for Line 11 renewable fuel penalty",
        ),
    )
    op.add_column(
        "compliance_report_summary",
        sa.Column(
            "low_carbon_penalty_override",
            sa.Float(),
            nullable=True,
            comment="Director override value for Line 21 low carbon fuel penalty",
        ),
    )
    op.add_column(
        "compliance_report_summary",
        sa.Column(
            "penalty_override_date",
            sa.TIMESTAMP(timezone=True),
            nullable=True,
            comment="Timestamp when penalty was last overridden",
        ),
    )
    op.add_column(
        "compliance_report_summary",
        sa.Column(
            "penalty_override_user",
            sa.Integer(),
            nullable=True,
            comment="User who made the penalty override",
        ),
    )
    op.create_foreign_key(
        None,
        "compliance_report_summary",
        "user_profile",
        ["penalty_override_user"],
        ["user_profile_id"],
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, "compliance_report_summary", type_="foreignkey")
    op.drop_column("compliance_report_summary", "penalty_override_user")
    op.drop_column("compliance_report_summary", "penalty_override_date")
    op.drop_column("compliance_report_summary", "low_carbon_penalty_override")
    op.drop_column("compliance_report_summary", "renewable_penalty_override")
    op.drop_column("compliance_report_summary", "penalty_override_enabled")
    # ### end Alembic commands ###